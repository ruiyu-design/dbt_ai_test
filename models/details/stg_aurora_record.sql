WITH records_spreadsheet_data AS (

SELECT record_id, workspace_id, resource_group_id, record_status, create_time, audio_duration, transcribe_language, creator_uid, found_uid, transcription_status, media_source, meeting_type, transcribe_speaker_num, transcription_type, audio_s3_url_origin, audio_upload_status,engine, share_status, record_title FROM `notta-data-analytics.notta_aurora.langogo_user_space_records0` union all
SELECT record_id, workspace_id, resource_group_id, record_status, create_time, audio_duration, transcribe_language, creator_uid, found_uid, transcription_status, media_source, meeting_type, transcribe_speaker_num, transcription_type, audio_s3_url_origin, audio_upload_status,engine, share_status, record_title FROM `notta-data-analytics.notta_aurora.langogo_user_space_records1` union all
SELECT record_id, workspace_id, resource_group_id, record_status, create_time, audio_duration, transcribe_language, creator_uid, found_uid, transcription_status, media_source, meeting_type, transcribe_speaker_num, transcription_type, audio_s3_url_origin, audio_upload_status,engine, share_status, record_title FROM `notta-data-analytics.notta_aurora.langogo_user_space_records2` union all
SELECT record_id, workspace_id, resource_group_id, record_status, create_time, audio_duration, transcribe_language, creator_uid, found_uid, transcription_status, media_source, meeting_type, transcribe_speaker_num, transcription_type, audio_s3_url_origin, audio_upload_status,engine, share_status, record_title FROM `notta-data-analytics.notta_aurora.langogo_user_space_records3` union all
SELECT record_id, workspace_id, resource_group_id, record_status, create_time, audio_duration, transcribe_language, creator_uid, found_uid, transcription_status, media_source, meeting_type, transcribe_speaker_num, transcription_type, audio_s3_url_origin, audio_upload_status,engine, share_status, record_title FROM `notta-data-analytics.notta_aurora.langogo_user_space_records4` union all
SELECT record_id, workspace_id, resource_group_id, record_status, create_time, audio_duration, transcribe_language, creator_uid, found_uid, transcription_status, media_source, meeting_type, transcribe_speaker_num, transcription_type, audio_s3_url_origin, audio_upload_status,engine, share_status, record_title FROM `notta-data-analytics.notta_aurora.langogo_user_space_records5` union all
SELECT record_id, workspace_id, resource_group_id, record_status, create_time, audio_duration, transcribe_language, creator_uid, found_uid, transcription_status, media_source, meeting_type, transcribe_speaker_num, transcription_type, audio_s3_url_origin, audio_upload_status,engine, share_status, record_title FROM `notta-data-analytics.notta_aurora.langogo_user_space_records6` union all
SELECT record_id, workspace_id, resource_group_id, record_status, create_time, audio_duration, transcribe_language, creator_uid, found_uid, transcription_status, media_source, meeting_type, transcribe_speaker_num, transcription_type, audio_s3_url_origin, audio_upload_status,engine, share_status, record_title FROM `notta-data-analytics.notta_aurora.langogo_user_space_records7` union all
SELECT record_id, workspace_id, resource_group_id, record_status, create_time, audio_duration, transcribe_language, creator_uid, found_uid, transcription_status, media_source, meeting_type, transcribe_speaker_num, transcription_type, audio_s3_url_origin, audio_upload_status,engine, share_status, record_title FROM `notta-data-analytics.notta_aurora.langogo_user_space_records8` union all
SELECT record_id, workspace_id, resource_group_id, record_status, create_time, audio_duration, transcribe_language, creator_uid, found_uid, transcription_status, media_source, meeting_type, transcribe_speaker_num, transcription_type, audio_s3_url_origin, audio_upload_status,engine, share_status, record_title FROM `notta-data-analytics.notta_aurora.langogo_user_space_records9` union all
SELECT record_id, workspace_id, resource_group_id, record_status, create_time, audio_duration, transcribe_language, creator_uid, found_uid, transcription_status, media_source, meeting_type, transcribe_speaker_num, transcription_type, audio_s3_url_origin, audio_upload_status,engine, share_status, record_title FROM `notta-data-analytics.notta_aurora.langogo_user_space_records10` union all
SELECT record_id, workspace_id, resource_group_id, record_status, create_time, audio_duration, transcribe_language, creator_uid, found_uid, transcription_status, media_source, meeting_type, transcribe_speaker_num, transcription_type, audio_s3_url_origin, audio_upload_status,engine, share_status, record_title FROM `notta-data-analytics.notta_aurora.langogo_user_space_records11` union all
SELECT record_id, workspace_id, resource_group_id, record_status, create_time, audio_duration, transcribe_language, creator_uid, found_uid, transcription_status, media_source, meeting_type, transcribe_speaker_num, transcription_type, audio_s3_url_origin, audio_upload_status,engine, share_status, record_title FROM `notta-data-analytics.notta_aurora.langogo_user_space_records12` union all
SELECT record_id, workspace_id, resource_group_id, record_status, create_time, audio_duration, transcribe_language, creator_uid, found_uid, transcription_status, media_source, meeting_type, transcribe_speaker_num, transcription_type, audio_s3_url_origin, audio_upload_status,engine, share_status, record_title FROM `notta-data-analytics.notta_aurora.langogo_user_space_records13` union all
SELECT record_id, workspace_id, resource_group_id, record_status, create_time, audio_duration, transcribe_language, creator_uid, found_uid, transcription_status, media_source, meeting_type, transcribe_speaker_num, transcription_type, audio_s3_url_origin, audio_upload_status,engine, share_status, record_title FROM `notta-data-analytics.notta_aurora.langogo_user_space_records14` union all
SELECT record_id, workspace_id, resource_group_id, record_status, create_time, audio_duration, transcribe_language, creator_uid, found_uid, transcription_status, media_source, meeting_type, transcribe_speaker_num, transcription_type, audio_s3_url_origin, audio_upload_status,engine, share_status, record_title FROM `notta-data-analytics.notta_aurora.langogo_user_space_records15` union all
SELECT record_id, workspace_id, resource_group_id, record_status, create_time, audio_duration, transcribe_language, creator_uid, found_uid, transcription_status, media_source, meeting_type, transcribe_speaker_num, transcription_type, audio_s3_url_origin, audio_upload_status,engine, share_status, record_title FROM `notta-data-analytics.notta_aurora.langogo_user_space_records16` union all
SELECT record_id, workspace_id, resource_group_id, record_status, create_time, audio_duration, transcribe_language, creator_uid, found_uid, transcription_status, media_source, meeting_type, transcribe_speaker_num, transcription_type, audio_s3_url_origin, audio_upload_status,engine, share_status, record_title FROM `notta-data-analytics.notta_aurora.langogo_user_space_records17` union all
SELECT record_id, workspace_id, resource_group_id, record_status, create_time, audio_duration, transcribe_language, creator_uid, found_uid, transcription_status, media_source, meeting_type, transcribe_speaker_num, transcription_type, audio_s3_url_origin, audio_upload_status,engine, share_status, record_title FROM `notta-data-analytics.notta_aurora.langogo_user_space_records18` union all
SELECT record_id, workspace_id, resource_group_id, record_status, create_time, audio_duration, transcribe_language, creator_uid, found_uid, transcription_status, media_source, meeting_type, transcribe_speaker_num, transcription_type, audio_s3_url_origin, audio_upload_status,engine, share_status, record_title FROM `notta-data-analytics.notta_aurora.langogo_user_space_records19` union all
SELECT record_id, workspace_id, resource_group_id, record_status, create_time, audio_duration, transcribe_language, creator_uid, found_uid, transcription_status, media_source, meeting_type, transcribe_speaker_num, transcription_type, audio_s3_url_origin, audio_upload_status,engine, share_status, record_title FROM `notta-data-analytics.notta_aurora.langogo_user_space_records20` union all
SELECT record_id, workspace_id, resource_group_id, record_status, create_time, audio_duration, transcribe_language, creator_uid, found_uid, transcription_status, media_source, meeting_type, transcribe_speaker_num, transcription_type, audio_s3_url_origin, audio_upload_status,engine, share_status, record_title FROM `notta-data-analytics.notta_aurora.langogo_user_space_records21` union all
SELECT record_id, workspace_id, resource_group_id, record_status, create_time, audio_duration, transcribe_language, creator_uid, found_uid, transcription_status, media_source, meeting_type, transcribe_speaker_num, transcription_type, audio_s3_url_origin, audio_upload_status,engine, share_status, record_title FROM `notta-data-analytics.notta_aurora.langogo_user_space_records22` union all
SELECT record_id, workspace_id, resource_group_id, record_status, create_time, audio_duration, transcribe_language, creator_uid, found_uid, transcription_status, media_source, meeting_type, transcribe_speaker_num, transcription_type, audio_s3_url_origin, audio_upload_status,engine, share_status, record_title FROM `notta-data-analytics.notta_aurora.langogo_user_space_records23` union all
SELECT record_id, workspace_id, resource_group_id, record_status, create_time, audio_duration, transcribe_language, creator_uid, found_uid, transcription_status, media_source, meeting_type, transcribe_speaker_num, transcription_type, audio_s3_url_origin, audio_upload_status,engine, share_status, record_title FROM `notta-data-analytics.notta_aurora.langogo_user_space_records24` union all
SELECT record_id, workspace_id, resource_group_id, record_status, create_time, audio_duration, transcribe_language, creator_uid, found_uid, transcription_status, media_source, meeting_type, transcribe_speaker_num, transcription_type, audio_s3_url_origin, audio_upload_status,engine, share_status, record_title FROM `notta-data-analytics.notta_aurora.langogo_user_space_records25` union all
SELECT record_id, workspace_id, resource_group_id, record_status, create_time, audio_duration, transcribe_language, creator_uid, found_uid, transcription_status, media_source, meeting_type, transcribe_speaker_num, transcription_type, audio_s3_url_origin, audio_upload_status,engine, share_status, record_title FROM `notta-data-analytics.notta_aurora.langogo_user_space_records26` union all
SELECT record_id, workspace_id, resource_group_id, record_status, create_time, audio_duration, transcribe_language, creator_uid, found_uid, transcription_status, media_source, meeting_type, transcribe_speaker_num, transcription_type, audio_s3_url_origin, audio_upload_status,engine, share_status, record_title FROM `notta-data-analytics.notta_aurora.langogo_user_space_records27` union all
SELECT record_id, workspace_id, resource_group_id, record_status, create_time, audio_duration, transcribe_language, creator_uid, found_uid, transcription_status, media_source, meeting_type, transcribe_speaker_num, transcription_type, audio_s3_url_origin, audio_upload_status,engine, share_status, record_title FROM `notta-data-analytics.notta_aurora.langogo_user_space_records28` union all
SELECT record_id, workspace_id, resource_group_id, record_status, create_time, audio_duration, transcribe_language, creator_uid, found_uid, transcription_status, media_source, meeting_type, transcribe_speaker_num, transcription_type, audio_s3_url_origin, audio_upload_status,engine, share_status, record_title FROM `notta-data-analytics.notta_aurora.langogo_user_space_records29` union all
SELECT record_id, workspace_id, resource_group_id, record_status, create_time, audio_duration, transcribe_language, creator_uid, found_uid, transcription_status, media_source, meeting_type, transcribe_speaker_num, transcription_type, audio_s3_url_origin, audio_upload_status,engine, share_status, record_title FROM `notta-data-analytics.notta_aurora.langogo_user_space_records30` union all
SELECT record_id, workspace_id, resource_group_id, record_status, create_time, audio_duration, transcribe_language, creator_uid, found_uid, transcription_status, media_source, meeting_type, transcribe_speaker_num, transcription_type, audio_s3_url_origin, audio_upload_status,engine, share_status, record_title FROM `notta-data-analytics.notta_aurora.langogo_user_space_records31` union all
SELECT record_id, workspace_id, resource_group_id, record_status, create_time, audio_duration, transcribe_language, creator_uid, found_uid, transcription_status, media_source, meeting_type, transcribe_speaker_num, transcription_type, audio_s3_url_origin, audio_upload_status,engine, share_status, record_title FROM `notta-data-analytics.notta_aurora.langogo_user_space_records32`

),

/*
 * @field transcription_type
 * @description Transliteration type
 * @type integer
 * @value 1 File transfer
 * @value 2 Real-time transfer
 * @value 3 Multilingual transfer
 * @value 4 Meeting transfer
 * @value 5 Accurate transfer
 * @value 6 Screen transfer
 * @value 7 MediaDownload transfer
 * @value 8 MultilingualFileTranscribe
 * @value 9 Subtitle
 * @value 10 MultilingualRealTimeTranscribe
 * @value 11 CalendarEventsAutoJoinMeeting
 * @value 12 Youtube

 * @field media_source
 * @description Audio and Video Sources
 * @type integer
 * @value 1 Hardware
 * @value 2 Web
 * @value 3 Android
 * @value 4 IOS
 * @value 5 IWatch (ios)
 * @value 6 ChromeExtension (extension)
 * @value 7 Official Website (web)
 * @value 8 SmartDevice(Memo+Zencord)

 * @field enable_speaker
 * @description Whether to open the speaker
 * @type integer
 * @value 0 Disable speaker
 * @value 1 Enable speaker
 */

records AS (
    SELECT
        record_id,
        workspace_id,
        TIMESTAMP_MILLIS(CAST(create_time AS INT64) * 1000) AS create_date,
        resource_group_id,
        record_status,
        audio_duration,
        transcribe_language,
        creator_uid,
        found_uid,
        transcription_type,
        transcription_status,
        media_source,
        meeting_type,
        CASE
            WHEN transcribe_speaker_num IN (0, 1) THEN 0
            ELSE 1
        END AS enable_speaker,
        audio_s3_url_origin,
        audio_upload_status,
        engine,
        transcribe_speaker_num,
        share_status,
        record_title
    FROM
        records_spreadsheet_data
    where
		audio_s3_url_origin not in
        (
        'https://s3.ap-northeast-1.amazonaws.com/langogo.rd.audio-corpus.lock/audio/ja-JP/f56dcabd-9270-4465-a592-1913cf0cc270_171_0.wav'--排除默认记录
        ,'https://s3.ap-northeast-1.amazonaws.com/langogo.rd.audio-corpus.lock/audio/en-US/1aa645ba-e302-4042-a1ef-9dab223ddc81_171_0.wav'--排除默认记录
        ,'https://s3.ap-northeast-1.amazonaws.com/langogo.rd.audio-corpus.lock/audio/en-US/demo.mp4'--排除默认记录
        ,'https://s3.ap-northeast-1.amazonaws.com/langogo.rd.audio-corpus.lock/audio/ja-JP/demo.mp4'--排除默认记录
        )
		and transcription_status = 2 --转写成功
		and record_id is not null
		and transcribe_language is not null
		and transcribe_language !=''
		and transcription_type is not null
		and (
			(transcription_type in (2,3,4,9,10,11) and audio_s3_url_origin is not null and audio_s3_url_origin!='')
			or
			(transcription_type in (1,5,6,7,8,12) and audio_upload_status = 100)
		) --实时文件地址不为空，非实时上传进度100%
) -- filter dirty data

SELECT
    record_id,
    workspace_id,
    create_date,
    resource_group_id,
    record_status,
    audio_duration,
    transcribe_language,
    creator_uid,
    found_uid,
    transcription_type,
    transcription_status,
    media_source,
    meeting_type,
    enable_speaker,
    audio_s3_url_origin,
    audio_upload_status,
    engine,
    transcribe_speaker_num,
    share_status,
    record_title
FROM
    records